<!DOCTYPE html><html lang="zh-CN"><head><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.css"><script src="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.js"></script><script src="https://cdn.jsdelivr.net/npm/meting@2/dist/Meting.min.js"></script><script src="https://cdn.jsdelivr.net/gh/Sanarous/files@1.151/js/clicklove.js"></script><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1"><meta name="format-detection" content="telephone=no"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black"><link rel="icon" href="/favicon/favicon-16x16.png?v=2.6.2" type="image/png" sizes="16x16"><link rel="icon" href="/favicon/favicon-32x32.png?v=2.6.2" type="image/png" sizes="32x32"><meta name="description" content="这里讲到了一些Spring的基础知识，也许不完整，之后应该会慢慢完善">
<meta property="og:type" content="article">
<meta property="og:title" content="Spring">
<meta property="og:url" content="http://example.com/2022/03/27/Spring/index.html">
<meta property="og:site_name" content="布小新的博客">
<meta property="og:description" content="这里讲到了一些Spring的基础知识，也许不完整，之后应该会慢慢完善">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://gitee.com/buxiaoxin2333/pic-bed/raw/master/img/68747470733a2f2f6d792d626c6f672d746f2d7573652e6f73732d636e2d6265696a696e672e616c6979756e63732e636f6d2f323031392d362f537072696e672545342542382542422545382541362538312545362541382541312545352539442539372e706e67.png">
<meta property="og:image" content="https://pic2.zhimg.com/50/v2-c68248bb5d9b4d64d22600571e996446_hd.jpg?source=1940ef5c">
<meta property="og:image" content="https://pic2.zhimg.com/80/v2-c68248bb5d9b4d64d22600571e996446_720w.jpg?source=1940ef5c">
<meta property="og:image" content="https://pic4.zhimg.com/50/v2-e64bf72c5c04412f626b21753aa9e1a1_hd.jpg?source=1940ef5c">
<meta property="og:image" content="https://pic4.zhimg.com/80/v2-e64bf72c5c04412f626b21753aa9e1a1_720w.jpg?source=1940ef5c">
<meta property="og:image" content="https://pic2.zhimg.com/50/v2-ee924f8693cff51785ad6637ac5b21c1_hd.jpg?source=1940ef5c">
<meta property="og:image" content="https://pic2.zhimg.com/80/v2-ee924f8693cff51785ad6637ac5b21c1_720w.jpg?source=1940ef5c">
<meta property="og:image" content="https://pic2.zhimg.com/80/v2-8ec294de7d0f9013788e3fb5c76069ef_720w.jpg?source=1940ef5c">
<meta property="og:image" content="https://pic2.zhimg.com/50/v2-64e8b19eeb70d9cf87c27fe4c5c0fc81_hd.jpg?source=1940ef5c">
<meta property="og:image" content="https://pic2.zhimg.com/80/v2-64e8b19eeb70d9cf87c27fe4c5c0fc81_720w.jpg?source=1940ef5c">
<meta property="og:image" content="https://pic4.zhimg.com/50/v2-82e0c12a1b26f7979ed9241e169affda_hd.jpg?source=1940ef5c">
<meta property="og:image" content="https://pic4.zhimg.com/80/v2-82e0c12a1b26f7979ed9241e169affda_720w.jpg?source=1940ef5c">
<meta property="og:image" content="https://pic2.zhimg.com/50/v2-c920a0540ce0651003a5326f6ef9891d_hd.jpg?source=1940ef5c">
<meta property="og:image" content="https://pic2.zhimg.com/80/v2-c920a0540ce0651003a5326f6ef9891d_720w.jpg?source=1940ef5c">
<meta property="og:image" content="https://pic2.zhimg.com/50/v2-99ad2cd809fcb86dd791ff7f65fb1779_hd.jpg?source=1940ef5c">
<meta property="og:image" content="https://pic2.zhimg.com/80/v2-99ad2cd809fcb86dd791ff7f65fb1779_720w.jpg?source=1940ef5c">
<meta property="og:image" content="https://pic4.zhimg.com/50/v2-861683acac47577c81f2b7493dd05649_hd.jpg?source=1940ef5c">
<meta property="og:image" content="https://pic4.zhimg.com/80/v2-861683acac47577c81f2b7493dd05649_720w.jpg?source=1940ef5c">
<meta property="og:image" content="https://pic3.zhimg.com/50/v2-c845802f9187953ed576e0555f76da42_hd.jpg?source=1940ef5c">
<meta property="og:image" content="https://pic3.zhimg.com/80/v2-c845802f9187953ed576e0555f76da42_720w.jpg?source=1940ef5c">
<meta property="og:image" content="https://pic3.zhimg.com/50/v2-555b2be7d76e78511a6d6fed3304927f_hd.jpg?source=1940ef5c">
<meta property="og:image" content="https://pic3.zhimg.com/80/v2-555b2be7d76e78511a6d6fed3304927f_720w.jpg?source=1940ef5c">
<meta property="og:image" content="https://pic4.zhimg.com/50/v2-24a96669241e81439c636e83976ba152_hd.jpg?source=1940ef5c">
<meta property="og:image" content="https://pic4.zhimg.com/80/v2-24a96669241e81439c636e83976ba152_720w.jpg?source=1940ef5c">
<meta property="og:image" content="https://pic2.zhimg.com/50/v2-5ca61395f37cef73c7bbe7808f9ea219_hd.jpg?source=1940ef5c">
<meta property="og:image" content="https://pic2.zhimg.com/80/v2-5ca61395f37cef73c7bbe7808f9ea219_720w.jpg?source=1940ef5c">
<meta property="og:image" content="https://gitee.com/buxiaoxin2333/pic-bed/raw/master/img/181454040628981.png">
<meta property="og:image" content="https://gitee.com/buxiaoxin2333/pic-bed/raw/master/img/68747470733a2f2f6d792d626c6f672d746f2d7573652e6f73732d636e2d6265696a696e672e616c6979756e63732e636f6d2f31382d392d31372f353439363430372e6a7067.jpg">
<meta property="article:published_time" content="2022-03-27T02:33:00.000Z">
<meta property="article:modified_time" content="2022-03-27T03:05:08.355Z">
<meta property="article:author" content="乄帝">
<meta property="article:tag" content="Spring">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://gitee.com/buxiaoxin2333/pic-bed/raw/master/img/68747470733a2f2f6d792d626c6f672d746f2d7573652e6f73732d636e2d6265696a696e672e616c6979756e63732e636f6d2f323031392d362f537072696e672545342542382542422545382541362538312545362541382541312545352539442539372e706e67.png"><title>Spring | 布小新的博客</title><link ref="canonical" href="http://example.com/2022/03/27/Spring/"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.12.1/css/all.min.css" type="text/css"><link rel="stylesheet" href="/css/index.css?v=2.6.2"><script>var Stun = window.Stun || {};
var CONFIG = {
  root: '/',
  algolia: undefined,
  assistSearch: undefined,
  fontIcon: {"prompt":{"success":"fas fa-check-circle","info":"fas fa-arrow-circle-right","warning":"fas fa-exclamation-circle","error":"fas fa-times-circle"},"copyBtn":"fas fa-copy"},
  sidebar: {"offsetTop":"20px","tocMaxDepth":6},
  header: {"enable":true,"showOnPost":true,"scrollDownIcon":true},
  postWidget: {"endText":true},
  nightMode: {"enable":true},
  back2top: {"enable":true},
  codeblock: {"style":"default","highlight":"light","wordWrap":false},
  reward: false,
  fancybox: false,
  zoomImage: {"gapAside":"20px"},
  galleryWaterfall: undefined,
  lazyload: false,
  pjax: {"avoidBanner":false},
  externalLink: {"icon":{"enable":true,"name":"fas fa-external-link-alt"}},
  shortcuts: undefined,
  prompt: {"copyButton":"复制","copySuccess":"复制成功","copyError":"复制失败"},
  sourcePath: {"js":"js","css":"css","images":"images"},
};

window.CONFIG = CONFIG;</script><meta name="generator" content="Hexo 6.0.0"></head><body><div class="container" id="container"><header class="header" id="header"><div class="header-inner"><nav class="header-nav header-nav--fixed"><div class="header-nav-inner"><div class="header-nav-menubtn"><i class="fas fa-bars"></i></div><div class="header-nav-menu"><div class="header-nav-menu-item"><a class="header-nav-menu-item__link" href="/"><span class="header-nav-menu-item__icon"><i class="fas fa-home"></i></span><span class="header-nav-menu-item__text">首页</span></a></div><div class="header-nav-menu-item"><a class="header-nav-menu-item__link" href="/archives/"><span class="header-nav-menu-item__icon"><i class="fas fa-folder-open"></i></span><span class="header-nav-menu-item__text">归档</span></a></div><div class="header-nav-menu-item"><a class="header-nav-menu-item__link" href="/tags/"><span class="header-nav-menu-item__icon"><i class="fas fa-tags"></i></span><span class="header-nav-menu-item__text">标签</span></a></div><div class="header-nav-menu-item"><a class="header-nav-menu-item__link" href="/categories/"><span class="header-nav-menu-item__icon"><i class="fas fa-tree"></i></span><span class="header-nav-menu-item__text">分类</span></a></div><div class="header-nav-menu-item"><a class="header-nav-menu-item__link" href="/about/"><span class="header-nav-menu-item__icon"><i class="fas fa-book"></i></span><span class="header-nav-menu-item__text">关于</span></a></div><div class="header-nav-menu-item"><a class="header-nav-menu-item__link" href="javascript:;" onclick="return false;"><span class="header-nav-menu-item__icon"><i class="fas fa-cat"></i></span><span class="header-nav-menu-item__text">生活</span></a><div class="header-nav-submenu"><div class="header-nav-submenu-item"><a class="header-nav-submenu-item__link" href="/html/reading/"><span class="header-nav-submenu-item__icon"><i class="fas fa-book-reader"></i></span><span class="header-nav-submenu-item__text">阅读</span></a></div></div></div></div><div class="header-nav-search"><span class="header-nav-search__icon"><i class="fas fa-search"></i></span><span class="header-nav-search__text">搜索</span></div><div class="header-nav-mode"><div class="mode"><div class="mode-track"><span class="mode-track-moon"></span><span class="mode-track-sun"></span></div><div class="mode-thumb"></div></div></div></div></nav><div class="header-banner"><div class="header-banner-info"><div class="header-banner-info__title">布小新的博客</div><div class="header-banner-info__subtitle">欢迎来到我的博客</div></div><div class="header-banner-arrow"><div class="header-banner-arrow__icon"><i class="fas fa-angle-down"></i></div></div></div><script src="/live2d-widget-master/autoload.js"></script></div></header><main class="main" id="main"><div class="main-inner"><div class="content-wrap" id="content-wrap"><div class="content" id="content"><!-- Just used to judge whether it is an article page--><div id="is-post"></div><div class="post"><header class="post-header"><h1 class="post-title">Spring</h1><div class="post-meta"><span class="post-meta-item post-meta-item--createtime"><span class="post-meta-item__icon"><i class="far fa-calendar-plus"></i></span><span class="post-meta-item__info">发表于</span><span class="post-meta-item__value">2022-03-27</span></span><span class="post-meta-item post-meta-item--updatetime"><span class="post-meta-item__icon"><i class="far fa-calendar-check"></i></span><span class="post-meta-item__info">更新于</span><span class="post-meta-item__value">2022-03-27</span></span></div></header><div class="post-body">
        <h1 id="Spring"   >
          <a href="#Spring" class="heading-link"><i class="fas fa-link"></i></a><a href="#Spring" class="headerlink" title="Spring"></a>Spring<img src="https://gitee.com/buxiaoxin2333/pic-bed/raw/master/img/68747470733a2f2f6d792d626c6f672d746f2d7573652e6f73732d636e2d6265696a696e672e616c6979756e63732e636f6d2f323031392d362f537072696e672545342542382542422545382541362538312545362541382541312545352539442539372e706e67.png" alt="Spring的各个组件"></h1>
      <p>具体文章可以看知乎上的这篇文章 <span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://www.zhihu.com/question/23277575/answer/169698662" >(41 封私信 &#x2F; 80 条消息) Spring IoC有什么好处呢？ - 知乎 (zhihu.com)</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p>

        <h2 id="IOC"   >
          <a href="#IOC" class="heading-link"><i class="fas fa-link"></i></a><a href="#IOC" class="headerlink" title="IOC"></a>IOC</h2>
      <p>要了解<strong>控制反转( Inversion of Control )</strong>, 我觉得有必要先了解软件设计的一个重要思想：<strong>依赖倒置原则（Dependency Inversion Principle ）</strong>。</p>
<p><strong>什么是依赖倒置原则？</strong>假设我们设计一辆汽车：先设计轮子，然后根据轮子大小设计底盘，接着根据底盘设计车身，最后根据车身设计好整个汽车。这里就出现了一个“依赖”关系：汽车依赖车身，车身依赖底盘，底盘依赖轮子。</p>
<p><img   src="https://pic2.zhimg.com/50/v2-c68248bb5d9b4d64d22600571e996446_hd.jpg?source=1940ef5c" style=""  alt="img"><img   src="https://pic2.zhimg.com/80/v2-c68248bb5d9b4d64d22600571e996446_720w.jpg?source=1940ef5c" style=""  alt="img"></p>
<p>这样的设计看起来没问题，但是可维护性却很低。假设设计完工之后，上司却突然说根据市场需求的变动，要我们把车子的轮子设计都改大一码。这下我们就蛋疼了：因为我们是根据轮子的尺寸设计的底盘，轮子的尺寸一改，底盘的设计就得修改；同样因为我们是根据底盘设计的车身，那么车身也得改，同理汽车设计也得改——整个设计几乎都得改！</p>
<p>我们现在换一种思路。我们先设计汽车的大概样子，然后根据汽车的样子来设计车身，根据车身来设计底盘，最后根据底盘来设计轮子。这时候，依赖关系就倒置过来了：轮子依赖底盘， 底盘依赖车身， 车身依赖汽车。</p>
<p><img   src="https://pic4.zhimg.com/50/v2-e64bf72c5c04412f626b21753aa9e1a1_hd.jpg?source=1940ef5c" style=""  alt="img"><img   src="https://pic4.zhimg.com/80/v2-e64bf72c5c04412f626b21753aa9e1a1_720w.jpg?source=1940ef5c" style=""  alt="img"></p>
<p>这时候，上司再说要改动轮子的设计，我们就只需要改动轮子的设计，而不需要动底盘，车身，汽车的设计了。</p>
<p>这就是依赖倒置原则——把原本的高层建筑依赖底层建筑“倒置”过来，变成底层建筑依赖高层建筑。高层建筑决定需要什么，底层去实现这样的需求，但是高层并不用管底层是怎么实现的。这样就不会出现前面的“牵一发动全身”的情况。</p>
<p><strong>控制反转（Inversion of Control）</strong> 就是依赖倒置原则的一种代码设计的思路。具体采用的方法就是所谓的<strong>依赖注入（Dependency Injection）</strong>。其实这些概念初次接触都会感到云里雾里的。说穿了，这几种概念的关系大概如下：</p>
<p><img   src="https://pic2.zhimg.com/50/v2-ee924f8693cff51785ad6637ac5b21c1_hd.jpg?source=1940ef5c" style=""  alt="img"><img   src="https://pic2.zhimg.com/80/v2-ee924f8693cff51785ad6637ac5b21c1_720w.jpg?source=1940ef5c" style=""  alt="img"></p>
<p>为了理解这几个概念，我们还是用上面汽车的例子。只不过这次换成代码。我们先定义四个Class，车，车身，底盘，轮胎。然后初始化这辆车，最后跑这辆车。代码结构如下：</p>
<p><img   src="https://pic2.zhimg.com/80/v2-8ec294de7d0f9013788e3fb5c76069ef_720w.jpg?source=1940ef5c" style=""  alt="img"></p>
<p>这样，就相当于上面第一个例子，上层建筑依赖下层建筑——每一个类的构造函数都直接调用了底层代码的构造函数。假设我们需要改动一下轮胎（Tire）类，把它的尺寸变成动态的，而不是一直都是30。我们需要这样改：</p>
<p><img   src="https://pic2.zhimg.com/50/v2-64e8b19eeb70d9cf87c27fe4c5c0fc81_hd.jpg?source=1940ef5c" style=""  alt="img"><img   src="https://pic2.zhimg.com/80/v2-64e8b19eeb70d9cf87c27fe4c5c0fc81_720w.jpg?source=1940ef5c" style=""  alt="img"></p>
<p>由于我们修改了轮胎的定义，为了让整个程序正常运行，我们需要做以下改动：</p>
<p><img   src="https://pic4.zhimg.com/50/v2-82e0c12a1b26f7979ed9241e169affda_hd.jpg?source=1940ef5c" style=""  alt="img"><img   src="https://pic4.zhimg.com/80/v2-82e0c12a1b26f7979ed9241e169affda_720w.jpg?source=1940ef5c" style=""  alt="img"></p>
<p>由此我们可以看到，仅仅是为了修改轮胎的构造函数，这种设计却需要<strong>修改整个上层所有类的构造函数</strong>！在软件工程中，<strong>这样的设计几乎是不可维护的</strong>——在实际工程项目中，有的类可能会是几千个类的底层，如果每次修改这个类，我们都要修改所有以它作为依赖的类，那软件的维护成本就太高了。</p>
<p>所以我们需要进行控制反转（IoC），及上层控制下层，而不是下层控制着上层。我们用依赖注入（Dependency Injection）这种方式来实现控制反转。<strong>所谓依赖注入，就是把底层类作为参数传入上层类，实现上层类对下层类的“控制</strong>”。这里我们用<strong>构造方法传递的依赖注入方式</strong>重新写车类的定义：</p>
<p><img   src="https://pic2.zhimg.com/50/v2-c920a0540ce0651003a5326f6ef9891d_hd.jpg?source=1940ef5c" style=""  alt="img"><img   src="https://pic2.zhimg.com/80/v2-c920a0540ce0651003a5326f6ef9891d_720w.jpg?source=1940ef5c" style=""  alt="img"></p>
<p>这里我们再把轮胎尺寸变成动态的，同样为了让整个系统顺利运行，我们需要做如下修改：</p>
<p><img   src="https://pic2.zhimg.com/50/v2-99ad2cd809fcb86dd791ff7f65fb1779_hd.jpg?source=1940ef5c" style=""  alt="img"><img   src="https://pic2.zhimg.com/80/v2-99ad2cd809fcb86dd791ff7f65fb1779_720w.jpg?source=1940ef5c" style=""  alt="img"></p>
<p>看到没？这里<strong>我只需要修改轮胎类就行了，不用修改其他任何上层类。</strong>这显然是更容易维护的代码。不仅如此，在实际的工程中，这种设计模式还有利于<strong>不同组的协同合作和单元测试：</strong>比如开发这四个类的分别是四个不同的组，那么只要定义好了接口，四个不同的组可以同时进行开发而不相互受限制；而对于单元测试，如果我们要写Car类的单元测试，就只需要Mock一下Framework类传入Car就行了，而不用把Framework, Bottom, Tire全部new一遍再来构造Car。</p>
<p>这里我们是采用的<strong>构造函数传入</strong>的方式进行的依赖注入。其实还有另外两种方法：<strong>Setter传递</strong>和<strong>接口传递</strong>。这里就不多讲了，核心思路都是一样的，都是为了实现<strong>控制反转</strong>。</p>
<p><img   src="https://pic4.zhimg.com/50/v2-861683acac47577c81f2b7493dd05649_hd.jpg?source=1940ef5c" style=""  alt="img"><img   src="https://pic4.zhimg.com/80/v2-861683acac47577c81f2b7493dd05649_720w.jpg?source=1940ef5c" style=""  alt="img"></p>
<p>看到这里你应该能理解什么控制反转和依赖注入了。那什么是**控制反转容器(IoC Container)**呢？其实上面的例子中，对车类进行初始化的那段代码发生的地方，就是控制反转容器。</p>
<p><img   src="https://pic3.zhimg.com/50/v2-c845802f9187953ed576e0555f76da42_hd.jpg?source=1940ef5c" style=""  alt="img"><img   src="https://pic3.zhimg.com/80/v2-c845802f9187953ed576e0555f76da42_720w.jpg?source=1940ef5c" style=""  alt="img"></p>
<p>显然你也应该观察到了，因为采用了依赖注入，在初始化的过程中就不可避免的会写大量的new。这里IoC容器就解决了这个问题。<strong>这个容器可以自动对你的代码进行初始化，你只需要维护一个Configuration（可以是xml可以是一段代码），而不用每次初始化一辆车都要亲手去写那一大段初始化的代码</strong>。这是引入IoC Container的第一个好处。</p>
<p>IoC Container的第二个好处是：<strong>我们在创建实例的时候不需要了解其中的细节。</strong>在上面的例子中，我们自己手动创建一个车instance时候，是从底层往上层new的：</p>
<p><img   src="https://pic3.zhimg.com/50/v2-555b2be7d76e78511a6d6fed3304927f_hd.jpg?source=1940ef5c" style=""  alt="img"><img   src="https://pic3.zhimg.com/80/v2-555b2be7d76e78511a6d6fed3304927f_720w.jpg?source=1940ef5c" style=""  alt="img"></p>
<p>这个过程中，我们需要了解整个Car&#x2F;Framework&#x2F;Bottom&#x2F;Tire类构造函数是怎么定义的，才能一步一步new&#x2F;注入。</p>
<p>而IoC Container在进行这个工作的时候是反过来的，它先从最上层开始往下找依赖关系，到达最底层之后再往上一步一步new（有点像深度优先遍历）：</p>
<p><img   src="https://pic4.zhimg.com/50/v2-24a96669241e81439c636e83976ba152_hd.jpg?source=1940ef5c" style=""  alt="img"><img   src="https://pic4.zhimg.com/80/v2-24a96669241e81439c636e83976ba152_720w.jpg?source=1940ef5c" style=""  alt="img"></p>
<p>这里IoC Container可以直接隐藏具体的创建实例的细节，在我们来看它就像一个工厂：</p>
<p><img   src="https://pic2.zhimg.com/50/v2-5ca61395f37cef73c7bbe7808f9ea219_hd.jpg?source=1940ef5c" style=""  alt="img"><img   src="https://pic2.zhimg.com/80/v2-5ca61395f37cef73c7bbe7808f9ea219_720w.jpg?source=1940ef5c" style=""  alt="img"></p>
<p>我们就像是工厂的客户。我们只需要向工厂请求一个Car实例，然后它就给我们按照Config创建了一个Car实例。我们完全不用管这个Car实例是怎么一步一步被创建出来。</p>
<p>实际项目中，有的Service Class可能是十年前写的，有几百个类作为它的底层。假设我们新写的一个API需要实例化这个Service，我们总不可能回头去搞清楚这几百个类的构造函数吧？IoC Container的这个特性就很完美的解决了这类问题——<strong>因为这个架构要求你在写class的时候需要写相应的Config文件，所以你要初始化很久以前的Service类的时候，前人都已经写好了Config文件，你直接在需要用的地方注入这个Service就可以了</strong>。这大大增加了项目的可维护性且降低了开发难度。</p>
<p>总结与理解：什么是IOC呢？控制反转是一种思想，也是实现了依赖倒置原则的一种思想，这里我的理解可以拆开来看，控制&#x2F;反转 首先控制指的是将对象交给IOC容器来管理，你无需考虑一个复杂的对象是如何创建的，同时容器也帮你维护了各个对象，你无需担心更多的问题。然后是反转，这涉及到依赖倒置原则，抽象不应该依赖于具体实现。具体还是要举例子来说明，就拿设计汽车来说，首先我们需要轮子然后是底盘和车身，也就是说汽车是依赖于车身，车身依赖于地盘而地盘有依赖于轮子（当然这里要讲讲依赖是指类中去创建对象）而这样的话如果你的轮子大小需求发生改变，你会发现变动会很大，（我去，好抽象，不知道怎么讲了）而如果说反转一下，也就是说车身依赖于汽车、地盘依赖于车身、轮胎依赖于地盘，就会出现不一样的东西，而这总反向的依赖关系需要注入来实现，构造器、setter、接口等注入方法，而这个注入的过程是由IOC容器来管理，用户是看不到的就像是一个工厂，当你需要Car，容器就给你一个，你并不清楚里面的具体情况，就像一个工厂，这里使用的就是类似于工厂模式。</p>

        <h2 id="aop"   >
          <a href="#aop" class="heading-link"><i class="fas fa-link"></i></a><a href="#aop" class="headerlink" title="aop"></a>aop</h2>
      <p>面向切面编程</p>

        <h2 id="Spring的生命周期"   >
          <a href="#Spring的生命周期" class="heading-link"><i class="fas fa-link"></i></a><a href="#Spring的生命周期" class="headerlink" title="Spring的生命周期"></a>Spring的生命周期</h2>
      <p>  <img src="https://gitee.com/buxiaoxin2333/pic-bed/raw/master/img/181454040628981.png" alt="生命周期"></p>
<p><img src="https://gitee.com/buxiaoxin2333/pic-bed/raw/master/img/68747470733a2f2f6d792d626c6f672d746f2d7573652e6f73732d636e2d6265696a696e672e616c6979756e63732e636f6d2f31382d392d31372f353439363430372e6a7067.jpg" alt="生命周期"></p>

        <h2 id="Spring-框架中用到了哪些设计模式？"   >
          <a href="#Spring-框架中用到了哪些设计模式？" class="heading-link"><i class="fas fa-link"></i></a><a href="#Spring-框架中用到了哪些设计模式？" class="headerlink" title="Spring 框架中用到了哪些设计模式？"></a>Spring 框架中用到了哪些设计模式？</h2>
      <ul>
<li><strong>工厂设计模式</strong> : Spring使用工厂模式通过 <code>BeanFactory</code>、<code>ApplicationContext</code> 创建 bean 对象。</li>
<li><strong>代理设计模式</strong> : Spring AOP 功能的实现。</li>
<li><strong>单例设计模式</strong> : Spring 中的 Bean 默认都是单例的。</li>
<li><strong>模板方法模式</strong> : Spring 中 <code>jdbcTemplate</code>、<code>hibernateTemplate</code> 等以 Template 结尾的对数据库操作的类，它们就使用到了模板模式。</li>
<li><strong>包装器设计模式</strong> : 我们的项目需要连接多个数据库，而且不同的客户在每次访问中根据需要会去访问不同的数据库。这种模式让我们可以根据客户的需求能够动态切换不同的数据源。</li>
<li><strong>观察者模式:</strong> Spring 事件驱动模型就是观察者模式很经典的一个应用。</li>
<li><strong>适配器模式</strong> :Spring AOP 的增强或通知(Advice)使用到了适配器模式、spring MVC 中也是用到了适配器模式适配<code>Controller</code>。</li>
<li>……</li>
</ul>

        <h2 id="Spring注入的方法（挺多的）"   >
          <a href="#Spring注入的方法（挺多的）" class="heading-link"><i class="fas fa-link"></i></a><a href="#Spring注入的方法（挺多的）" class="headerlink" title="Spring注入的方法（挺多的）"></a>Spring注入的方法（挺多的）</h2>
      
        <h3 id="bean-xml注入"   >
          <a href="#bean-xml注入" class="heading-link"><i class="fas fa-link"></i></a><a href="#bean-xml注入" class="headerlink" title="bean.xml注入"></a>bean.xml注入</h3>
      
        <h4 id="1-构造器注入-（空构造、含参构造）"   >
          <a href="#1-构造器注入-（空构造、含参构造）" class="heading-link"><i class="fas fa-link"></i></a><a href="#1-构造器注入-（空构造、含参构造）" class="headerlink" title="1.构造器注入 （空构造、含参构造）"></a>1.构造器注入 （空构造、含参构造）</h4>
      <figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">空构造注入</span><br><span class="line">&lt;bean id=&quot;person&quot; class=&quot;com.spring.demo.pojo.Person&quot;&gt;&lt;/bean&gt;</span><br><span class="line"></span><br><span class="line">其他构造注入</span><br><span class="line">&lt;bean id=&quot;person&quot; class=&quot;com.spring.demo.pojo.Person&quot;&gt;</span><br><span class="line">    &lt;constructor-arg index=&quot;0&quot; value=&quot;test&quot;&gt;&lt;/constructor-arg&gt;</span><br><span class="line">    &lt;constructor-arg index=&quot;1&quot; value=&quot;1&quot;&gt;&lt;/constructor-arg&gt;</span><br><span class="line">&lt;/bean&gt;</span><br><span class="line">--------------------------------------------------</span><br><span class="line">ClassPathXmlApplicationContext context = new ClassPathXmlApplicationContext(&quot;classpath:bean.xml&quot;);</span><br><span class="line">Person pesson = (Person)context.getBean(&quot;person&quot;);</span><br></pre></td></tr></table></div></figure>


        <h4 id="2-Setter（前提是要由set方法）"   >
          <a href="#2-Setter（前提是要由set方法）" class="heading-link"><i class="fas fa-link"></i></a><a href="#2-Setter（前提是要由set方法）" class="headerlink" title="2.Setter（前提是要由set方法）"></a>2.Setter（前提是要由set方法）</h4>
      <p>​    </p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">&lt;bean id=&quot;person&quot; class=&quot;com.spring.demo.pojo.Person&quot;&gt;</span><br><span class="line">    &lt;property name=&quot;name&quot; value=&quot;test&quot;&gt;&lt;/property&gt;</span><br><span class="line">    &lt;property name=&quot;num&quot; value=&quot;1&quot;&gt;&lt;/property&gt;</span><br><span class="line">&lt;/bean&gt;</span><br><span class="line">---------------------------------------------------</span><br><span class="line">ClassPathXmlApplicationContext context = new ClassPathXmlApplicationContext(&quot;classpath:bean.xml&quot;);</span><br><span class="line">Person pesson = (Person)context.getBean(&quot;person&quot;);</span><br><span class="line"></span><br></pre></td></tr></table></div></figure>


        <h4 id="3-静态工厂方法注入"   >
          <a href="#3-静态工厂方法注入" class="heading-link"><i class="fas fa-link"></i></a><a href="#3-静态工厂方法注入" class="headerlink" title="3.静态工厂方法注入"></a>3.静态工厂方法注入</h4>
      <figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">   </span><br><span class="line">   public class PersonStaticFactory &#123;</span><br><span class="line">   	public static Person getPerson(String name,String num)&#123;</span><br><span class="line">       	return new Person(name,num);</span><br><span class="line">   	&#125;</span><br><span class="line">&#125;</span><br><span class="line">   ---------------------------------------------------</span><br><span class="line">   &lt;bean id=&quot;personFactory&quot; class=&quot;com.spring.demo.factory.PersonStaticFactory&quot; factory-method=&quot;getPerson&quot;&gt;</span><br><span class="line">       &lt;constructor-arg index=&quot;0&quot; value=&quot;test&quot;&gt;&lt;/constructor-arg&gt;</span><br><span class="line">       &lt;constructor-arg index=&quot;1&quot; value=&quot;1&quot;&gt;&lt;/constructor-arg&gt;</span><br><span class="line">   &lt;/bean&gt;</span><br><span class="line">   ----------------------------------------------------</span><br><span class="line">   </span><br><span class="line">   ClassPathXmlApplicationContext context = new ClassPathXmlApplicationContext(&quot;classpath:bean.xml&quot;);</span><br><span class="line">   Person pesson = (Person)context.getBean(&quot;personFactory&quot;);</span><br></pre></td></tr></table></div></figure>


        <h4 id="4-实力工厂方法注入"   >
          <a href="#4-实力工厂方法注入" class="heading-link"><i class="fas fa-link"></i></a><a href="#4-实力工厂方法注入" class="headerlink" title="4.实力工厂方法注入"></a>4.实力工厂方法注入</h4>
      <p>​    这个和静态工厂的区别，首先他不是静态方法了。。</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">   public class PersonFactory &#123;</span><br><span class="line">   	public Person getPerson(String name,String num)&#123;</span><br><span class="line">       	return new Person(name,num);</span><br><span class="line">  	 	&#125;</span><br><span class="line">&#125;</span><br><span class="line">   ----------------------------------------------------</span><br><span class="line">   &lt;bean id=&quot;personFactory&quot; class=&quot;com.spring.demo.factory.PersonFactory&quot;&gt;&lt;/bean&gt;</span><br><span class="line">   &lt;bean id=&quot;person&quot; factory-bean=&quot;personFactory&quot; factory-method=&quot;getPerson&quot;&gt;</span><br><span class="line">       &lt;constructor-arg index=&quot;0&quot; value=&quot;test&quot;&gt;&lt;/constructor-arg&gt;</span><br><span class="line">       &lt;constructor-arg index=&quot;1&quot; value=&quot;1&quot;&gt;&lt;/constructor-arg&gt;</span><br><span class="line">   &lt;/bean&gt;</span><br><span class="line">   </span><br><span class="line">   ----------------------------------------------------</span><br><span class="line">   ClassPathXmlApplicationContext context = new ClassPathXmlApplicationContext(&quot;classpath:bean.xml&quot;);</span><br><span class="line">   Person pesson = (Person)context.getBean(&quot;person&quot;);</span><br></pre></td></tr></table></div></figure>


        <h4 id="5-FactoryBean注入（主要是工厂实现FactoryBean接口）"   >
          <a href="#5-FactoryBean注入（主要是工厂实现FactoryBean接口）" class="heading-link"><i class="fas fa-link"></i></a><a href="#5-FactoryBean注入（主要是工厂实现FactoryBean接口）" class="headerlink" title="5.FactoryBean注入（主要是工厂实现FactoryBean接口）"></a>5.FactoryBean注入（主要是工厂实现FactoryBean接口）</h4>
      <figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">public class PersonFactoryBean implements FactoryBean &#123;</span><br><span class="line">    @Override</span><br><span class="line">    public Object getObject() throws Exception &#123;</span><br><span class="line">        return new Person();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public Class&lt;?&gt; getObjectType() &#123;</span><br><span class="line">        return Person.class;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">------------------------------------------------</span><br><span class="line">&lt;bean id=&quot;personFactoryBean&quot; class=&quot;com.spring.demo.factory.PersonFactoryBean&quot;&gt;&lt;/bean&gt;</span><br><span class="line"></span><br><span class="line">------------------------------------------------</span><br><span class="line">ClassPathXmlApplicationContext context = new ClassPathXmlApplicationContext(&quot;classpath:bean.xml&quot;);</span><br><span class="line">Person person = (Person)context.getBean(&quot;personFactoryBean&quot;);</span><br></pre></td></tr></table></div></figure>




        <h3 id="注解注入"   >
          <a href="#注解注入" class="heading-link"><i class="fas fa-link"></i></a><a href="#注解注入" class="headerlink" title="注解注入"></a>注解注入</h3>
      
        <h4 id="1-Component、-Controller-、-Service-、-Repository等注解可以定义bean"   >
          <a href="#1-Component、-Controller-、-Service-、-Repository等注解可以定义bean" class="heading-link"><i class="fas fa-link"></i></a><a href="#1-Component、-Controller-、-Service-、-Repository等注解可以定义bean" class="headerlink" title="1.@Component、@Controller 、@Service 、@Repository等注解可以定义bean"></a>1.@Component、@Controller 、@Service 、@Repository等注解可以定义bean</h4>
      <p>其实后面三个都是基于@Component，不过业界的规矩就是</p>
<p>​    Controller一般用在控制层</p>
<p>​    Service一般用在业务层</p>
<p>​    Repository一般用在数据层</p>
<p>​    Component 一般是公共组件</p>
<p>这里要注意的是如果你的这个注解用在了不和SpringBoot入口类同一级包下的话，需要配置注解扫描</p>
<p>&lt;context:component-scan base-package&#x3D;””&gt;</p>
<p>在入口类上写上@CompoentScan(“xxxx”)</p>

        <h4 id="2-JavaConfig"   >
          <a href="#2-JavaConfig" class="heading-link"><i class="fas fa-link"></i></a><a href="#2-JavaConfig" class="headerlink" title="2.JavaConfig"></a>2.JavaConfig</h4>
      <figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">@Configuration</span><br><span class="line">public class MyBeanConfiguration &#123;</span><br><span class="line">    //@ConditionalOnXX 这个注解可以加限制</span><br><span class="line">    @Bean</span><br><span class="line">    public Person createPerson()&#123;</span><br><span class="line">        return new Person();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>




        <h4 id="3-Import注解"   >
          <a href="#3-Import注解" class="heading-link"><i class="fas fa-link"></i></a><a href="#3-Import注解" class="headerlink" title="3.Import注解"></a>3.Import注解</h4>
      <figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">@Configuration</span><br><span class="line">@Import(&#123;Person.class, Role.class&#125;)</span><br><span class="line">public class MyBeanConfig &#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">----------------------------------------</span><br><span class="line">    @Autowired</span><br><span class="line">    Person person;</span><br><span class="line">    @Autowired</span><br><span class="line">    Role role;</span><br></pre></td></tr></table></div></figure>




        <h4 id="4-ImportSelector-实现ImportSelector接口"   >
          <a href="#4-ImportSelector-实现ImportSelector接口" class="heading-link"><i class="fas fa-link"></i></a><a href="#4-ImportSelector-实现ImportSelector接口" class="headerlink" title="4.ImportSelector(实现ImportSelector接口)"></a>4.ImportSelector(实现ImportSelector接口)</h4>
      <figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">public class DataImportSelector implements ImportSelector &#123;</span><br><span class="line">    @Override</span><br><span class="line">    public String[] selectImports(AnnotationMetadata annotationMetadata) &#123;</span><br><span class="line">        return new String[]&#123;</span><br><span class="line">                &quot;com.spring.demo.pojo.Person&quot;,&quot;com.spring.demo.pojo.Role&quot;</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">-----------------------------------------</span><br><span class="line">@Configuration</span><br><span class="line">@Import(&#123;DataImportSelector.class&#125;)</span><br><span class="line">public class MyBeanConfig &#123;</span><br><span class="line">&#125;</span><br><span class="line">-----------------------------------------</span><br><span class="line">这个方法有问题，我不知道怎么找到。。。。</span><br></pre></td></tr></table></div></figure>




        <h4 id="5-ImportBeanDefinitionRegistrar-实现ImportBeanDefinitionRegistrar）"   >
          <a href="#5-ImportBeanDefinitionRegistrar-实现ImportBeanDefinitionRegistrar）" class="heading-link"><i class="fas fa-link"></i></a><a href="#5-ImportBeanDefinitionRegistrar-实现ImportBeanDefinitionRegistrar）" class="headerlink" title="5.ImportBeanDefinitionRegistrar(实现ImportBeanDefinitionRegistrar）"></a>5.ImportBeanDefinitionRegistrar(实现ImportBeanDefinitionRegistrar）</h4>
      <figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">public class PersonImportSelector implements ImportBeanDefinitionRegistrar &#123;</span><br><span class="line">    @Override</span><br><span class="line">    public void registerBeanDefinitions(AnnotationMetadata importingClassMetadata, BeanDefinitionRegistry registry, BeanNameGenerator importBeanNameGenerator) &#123;</span><br><span class="line">        System.out.println(&quot;这里注入两个实例&quot;);</span><br><span class="line">        RootBeanDefinition rootBeanDefinition = new RootBeanDefinition(Person.class);</span><br><span class="line">        registry.registerBeanDefinition(&quot;person&quot;,rootBeanDefinition);</span><br><span class="line"></span><br><span class="line">        RootBeanDefinition rootBeanDefinition1 = new RootBeanDefinition(Role.class);</span><br><span class="line">        registry.registerBeanDefinition(&quot;role&quot;,rootBeanDefinition1);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">-------------------------------------------</span><br><span class="line">@Configuration</span><br><span class="line">@Import(&#123;PersonImportSelector.class&#125;)</span><br><span class="line">public class MyBeanConfig &#123;</span><br><span class="line">&#125;</span><br><span class="line">   </span><br><span class="line">   </span><br><span class="line">--------------------------------------------</span><br><span class="line">   @Autowired</span><br><span class="line">    ApplicationContext context;//这里需要获取上下文</span><br><span class="line">    </span><br><span class="line">    Person person = (Person) context.getBean(&quot;person&quot;);</span><br><span class="line">    </span><br><span class="line">    </span><br></pre></td></tr></table></div></figure>




        <h4 id="6-PostProcessor-后处理器—这让我联想到了Spring的生命周期，其中就有Bean和BeanFactory的后处理器参与-——–实现BeanDefinitionRegistryPostProcess"   >
          <a href="#6-PostProcessor-后处理器—这让我联想到了Spring的生命周期，其中就有Bean和BeanFactory的后处理器参与-——–实现BeanDefinitionRegistryPostProcess" class="heading-link"><i class="fas fa-link"></i></a><a href="#6-PostProcessor-后处理器—这让我联想到了Spring的生命周期，其中就有Bean和BeanFactory的后处理器参与-——–实现BeanDefinitionRegistryPostProcess" class="headerlink" title="6.PostProcessor(后处理器—这让我联想到了Spring的生命周期，其中就有Bean和BeanFactory的后处理器参与)——–实现BeanDefinitionRegistryPostProcess"></a>6.PostProcessor(后处理器—这让我联想到了Spring的生命周期，其中就有Bean和BeanFactory的后处理器参与)——–实现BeanDefinitionRegistryPostProcess</h4>
      <figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">@Component</span><br><span class="line">public class MyRegistryPostProcess implements BeanDefinitionRegistryPostProcessor &#123;</span><br><span class="line">    @Override</span><br><span class="line">    public void postProcessBeanDefinitionRegistry(BeanDefinitionRegistry beanDefinitionRegistry) throws BeansException &#123;</span><br><span class="line">        System.out.println(&quot;自定义BeanDefinition后处理器&quot;);</span><br><span class="line">        RootBeanDefinition rootBeanDefinition = new RootBeanDefinition(Person.class);</span><br><span class="line">        beanDefinitionRegistry.registerBeanDefinition(&quot;person&quot;,rootBeanDefinition);</span><br><span class="line"></span><br><span class="line">        RootBeanDefinition rootBeanDefinition1 = new RootBeanDefinition(Role.class);</span><br><span class="line">        beanDefinitionRegistry.registerBeanDefinition(&quot;role&quot;,rootBeanDefinition1);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public void postProcessBeanFactory(ConfigurableListableBeanFactory configurableListableBeanFactory) throws BeansException &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">//这里你会发现还有一个方法postProcessBeanFactory 这也是父类BeanFactoryPostProcessor的一个方法，这里都可以注册bean</span><br><span class="line">区别在于</span><br><span class="line">	BeanDefinitionRegistryPostProcessor更侧重于bean的注册</span><br><span class="line">	BeanFactoryPostProcessor更侧重于对已经注册的bean的属性进行修改</span><br></pre></td></tr></table></div></figure>






        <h1 id="扩展"   >
          <a href="#扩展" class="heading-link"><i class="fas fa-link"></i></a><a href="#扩展" class="headerlink" title="扩展"></a>扩展</h1>
      <p>SpringMVC的核心是DispatcherServlet</p>
<p>而这里涉及到一个抽象类 AbstarctAnnotationConfigDispatcherServletInitializer  当其部署到Servlet3.0容器中的时候，容器会自动发现它，并用它来配置Servlet上下文 它也会同时创建DispatcherServlet和ContextLoaderListener</p>
<p>这里你要仔细观察 官方对于这个类方法中的解释</p>
<p>一个创建了根应用上下文是由ContextLoaderListener提供</p>
<p>一个创建了Servlet应用上下文是由DispatcherServlet提供</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">Create the &quot;root&quot; application context to be provided to the ContextLoaderListener.</span><br><span class="line">The returned context is delegated to ContextLoaderListener.ContextLoaderListener(WebApplicationContext) and will be established as the parent context for any DispatcherServlet application contexts. As such, it typically contains middle-tier services, data sources, etc.</span><br><span class="line">This implementation creates an AnnotationConfigWebApplicationContext, providing it the annotated classes returned by getRootConfigClasses(). Returns null if getRootConfigClasses() returns null.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">@Override</span><br><span class="line">@Nullable</span><br><span class="line">protected WebApplicationContext createRootApplicationContext() &#123;</span><br><span class="line">   Class&lt;?&gt;[] configClasses = getRootConfigClasses();</span><br><span class="line">   if (!ObjectUtils.isEmpty(configClasses)) &#123;</span><br><span class="line">      AnnotationConfigWebApplicationContext context = new AnnotationConfigWebApplicationContext();</span><br><span class="line">      context.register(configClasses);</span><br><span class="line">      return context;</span><br><span class="line">   &#125;</span><br><span class="line">   else &#123;</span><br><span class="line">      return null;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Create a servlet application context to be provided to the DispatcherServlet.</span><br><span class="line">The returned context is delegated to Spring&#x27;s DispatcherServlet.DispatcherServlet(WebApplicationContext). As such, it typically contains controllers, view resolvers, locale resolvers, and other web-related beans.</span><br><span class="line">This implementation creates an AnnotationConfigWebApplicationContext, providing it the annotated classes returned by getServletConfigClasses().</span><br><span class="line"></span><br><span class="line">@Override</span><br><span class="line">protected WebApplicationContext createServletApplicationContext() &#123;</span><br><span class="line">   AnnotationConfigWebApplicationContext context = new AnnotationConfigWebApplicationContext();</span><br><span class="line">   Class&lt;?&gt;[] configClasses = getServletConfigClasses();</span><br><span class="line">   if (!ObjectUtils.isEmpty(configClasses)) &#123;</span><br><span class="line">      context.register(configClasses);</span><br><span class="line">   &#125;</span><br><span class="line">   return context;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>



<p>当DispatcherServlet启动的时候，它会创建Spring应用上下文，并加载配置文件和配置类中所声明的bean</p>
<p>我们希望DispatcherServlet加载包含Web组件的bean，如控制器、视图解析器以及处理映射，而ContextLoaderListener要加载应用中的其他bean。这些bean通常是驱动应用后端的中间件和数据层组件</p>
</div><footer class="post-footer"><div class="post-ending ending"><div class="ending__text">------ 本文结束，感谢您的阅读 ------</div></div><div class="post-copyright copyright"><div class="copyright-author"><span class="copyright-author__name">本文作者: </span><span class="copyright-author__value"><a href="http://example.com">乄帝</a></span></div><div class="copyright-link"><span class="copyright-link__name">本文链接: </span><span class="copyright-link__value"><a href="http://example.com/2022/03/27/Spring/">http://example.com/2022/03/27/Spring/</a></span></div><div class="copyright-notice"><span class="copyright-notice__name">版权声明: </span><span class="copyright-notice__value">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.en" rel="external nofollow" target="_blank">BY-NC-SA</a> 许可协议。转载请注明出处！</span></div></div><div class="post-tags"><span class="post-tags-item"><span class="post-tags-item__icon"><i class="fas fa-tag"></i></span><a class="post-tags-item__link" href="http://example.com/tags/Spring/">Spring</a></span></div><nav class="post-paginator paginator"><div class="paginator-next"><a class="paginator-next__link" href="/2022/03/20/ElasticSearch(%E5%BA%93%E3%80%81%E8%A1%A8%E3%80%81%E8%AE%B0%E5%BD%95)%20-%20%E7%8B%82%E7%A5%9E%E7%AF%87%E5%85%A5%E9%97%A8/"><span class="paginator-prev__text">ElasticSearch(库、表、记录) - 入门</span><span class="paginator-next__icon"><i class="fas fa-angle-right"></i></span></a></div></nav></footer></div></div></div><div class="sidebar-wrap" id="sidebar-wrap"><aside class="sidebar" id="sidebar"><div class="sidebar-nav"><span class="sidebar-nav-toc current">文章目录</span><span class="sidebar-nav-ov">站点概览</span></div><section class="sidebar-toc"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Spring"><span class="toc-number">1.</span> <span class="toc-text">
          Spring</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#IOC"><span class="toc-number">1.1.</span> <span class="toc-text">
          IOC</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#aop"><span class="toc-number">1.2.</span> <span class="toc-text">
          aop</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Spring%E7%9A%84%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F"><span class="toc-number">1.3.</span> <span class="toc-text">
          Spring的生命周期</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Spring-%E6%A1%86%E6%9E%B6%E4%B8%AD%E7%94%A8%E5%88%B0%E4%BA%86%E5%93%AA%E4%BA%9B%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%EF%BC%9F"><span class="toc-number">1.4.</span> <span class="toc-text">
          Spring 框架中用到了哪些设计模式？</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Spring%E6%B3%A8%E5%85%A5%E7%9A%84%E6%96%B9%E6%B3%95%EF%BC%88%E6%8C%BA%E5%A4%9A%E7%9A%84%EF%BC%89"><span class="toc-number">1.5.</span> <span class="toc-text">
          Spring注入的方法（挺多的）</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#bean-xml%E6%B3%A8%E5%85%A5"><span class="toc-number">1.5.1.</span> <span class="toc-text">
          bean.xml注入</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-%E6%9E%84%E9%80%A0%E5%99%A8%E6%B3%A8%E5%85%A5-%EF%BC%88%E7%A9%BA%E6%9E%84%E9%80%A0%E3%80%81%E5%90%AB%E5%8F%82%E6%9E%84%E9%80%A0%EF%BC%89"><span class="toc-number">1.5.1.1.</span> <span class="toc-text">
          1.构造器注入 （空构造、含参构造）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-Setter%EF%BC%88%E5%89%8D%E6%8F%90%E6%98%AF%E8%A6%81%E7%94%B1set%E6%96%B9%E6%B3%95%EF%BC%89"><span class="toc-number">1.5.1.2.</span> <span class="toc-text">
          2.Setter（前提是要由set方法）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-%E9%9D%99%E6%80%81%E5%B7%A5%E5%8E%82%E6%96%B9%E6%B3%95%E6%B3%A8%E5%85%A5"><span class="toc-number">1.5.1.3.</span> <span class="toc-text">
          3.静态工厂方法注入</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-%E5%AE%9E%E5%8A%9B%E5%B7%A5%E5%8E%82%E6%96%B9%E6%B3%95%E6%B3%A8%E5%85%A5"><span class="toc-number">1.5.1.4.</span> <span class="toc-text">
          4.实力工厂方法注入</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-FactoryBean%E6%B3%A8%E5%85%A5%EF%BC%88%E4%B8%BB%E8%A6%81%E6%98%AF%E5%B7%A5%E5%8E%82%E5%AE%9E%E7%8E%B0FactoryBean%E6%8E%A5%E5%8F%A3%EF%BC%89"><span class="toc-number">1.5.1.5.</span> <span class="toc-text">
          5.FactoryBean注入（主要是工厂实现FactoryBean接口）</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B3%A8%E8%A7%A3%E6%B3%A8%E5%85%A5"><span class="toc-number">1.5.2.</span> <span class="toc-text">
          注解注入</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-Component%E3%80%81-Controller-%E3%80%81-Service-%E3%80%81-Repository%E7%AD%89%E6%B3%A8%E8%A7%A3%E5%8F%AF%E4%BB%A5%E5%AE%9A%E4%B9%89bean"><span class="toc-number">1.5.2.1.</span> <span class="toc-text">
          1.@Component、@Controller 、@Service 、@Repository等注解可以定义bean</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-JavaConfig"><span class="toc-number">1.5.2.2.</span> <span class="toc-text">
          2.JavaConfig</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-Import%E6%B3%A8%E8%A7%A3"><span class="toc-number">1.5.2.3.</span> <span class="toc-text">
          3.Import注解</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-ImportSelector-%E5%AE%9E%E7%8E%B0ImportSelector%E6%8E%A5%E5%8F%A3"><span class="toc-number">1.5.2.4.</span> <span class="toc-text">
          4.ImportSelector(实现ImportSelector接口)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-ImportBeanDefinitionRegistrar-%E5%AE%9E%E7%8E%B0ImportBeanDefinitionRegistrar%EF%BC%89"><span class="toc-number">1.5.2.5.</span> <span class="toc-text">
          5.ImportBeanDefinitionRegistrar(实现ImportBeanDefinitionRegistrar）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-PostProcessor-%E5%90%8E%E5%A4%84%E7%90%86%E5%99%A8%E2%80%94%E8%BF%99%E8%AE%A9%E6%88%91%E8%81%94%E6%83%B3%E5%88%B0%E4%BA%86Spring%E7%9A%84%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F%EF%BC%8C%E5%85%B6%E4%B8%AD%E5%B0%B1%E6%9C%89Bean%E5%92%8CBeanFactory%E7%9A%84%E5%90%8E%E5%A4%84%E7%90%86%E5%99%A8%E5%8F%82%E4%B8%8E-%E2%80%94%E2%80%94%E2%80%93%E5%AE%9E%E7%8E%B0BeanDefinitionRegistryPostProcess"><span class="toc-number">1.5.2.6.</span> <span class="toc-text">
          6.PostProcessor(后处理器—这让我联想到了Spring的生命周期，其中就有Bean和BeanFactory的后处理器参与)——–实现BeanDefinitionRegistryPostProcess</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%89%A9%E5%B1%95"><span class="toc-number">2.</span> <span class="toc-text">
          扩展</span></a></li></ol></section><!-- ov = overview--><section class="sidebar-ov hide"><div class="sidebar-ov-author"><div class="sidebar-ov-author__avatar"><img class="sidebar-ov-author__avatar_img" src="/wallhaven-zxozdw_128x128.png" alt="avatar"></div><p class="sidebar-ov-author__text">山不在高有仙则名，水不在深有龙则灵</p></div><div class="sidebar-ov-social"><a class="sidebar-ov-social-item" href="https://github.com/Tassdar2333" target="_blank" rel="noopener" data-popover="Github" data-popover-pos="up"><span class="sidebar-ov-social-item__icon"><i class="fab fa-github"></i></span></a><a class="sidebar-ov-social-item" href="https://plus.google.com/" target="_blank" rel="noopener" data-popover="QQ" data-popover-pos="up"><span class="sidebar-ov-social-item__icon"><i class="fab fa-google"></i></span></a><a class="sidebar-ov-social-item" href="https://twitter.com/" target="_blank" rel="noopener" data-popover="Twitter" data-popover-pos="up"><span class="sidebar-ov-social-item__icon"><i class="fab fa-twitter"></i></span></a><a class="sidebar-ov-social-item" href="https://youtube.com/" target="_blank" rel="noopener" data-popover="Youtube" data-popover-pos="up"><span class="sidebar-ov-social-item__icon"><i class="fab fa-youtube"></i></span></a></div><div class="sidebar-ov-state"><a class="sidebar-ov-state-item sidebar-ov-state-item--posts" href="/archives/"><div class="sidebar-ov-state-item__count">7</div><div class="sidebar-ov-state-item__name">归档</div></a><a class="sidebar-ov-state-item sidebar-ov-state-item--categories" href="/categories/"><div class="sidebar-ov-state-item__count">4</div><div class="sidebar-ov-state-item__name">分类</div></a><a class="sidebar-ov-state-item sidebar-ov-state-item--tags" href="/tags/"><div class="sidebar-ov-state-item__count">5</div><div class="sidebar-ov-state-item__name">标签</div></a></div><div class="sidebar-ov-cc"><a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.en" target="_blank" rel="noopener" data-popover="知识共享许可协议" data-popover-pos="up"><img src="/images/cc-by-nc-sa.svg"></a></div></section><div class="sidebar-reading"><div class="sidebar-reading-info"><span class="sidebar-reading-info__text">你已阅读了 </span><span class="sidebar-reading-info__num">0</span><span class="sidebar-reading-info__perc">%</span></div><div class="sidebar-reading-line"></div></div></aside></div><div class="clearfix"></div></div></main><footer class="footer" id="footer"><div class="footer-inner"><meting-js server="netease" type="playlist" fixed="true" id="7081604432"></meting-js><div><span>Copyright © 2022</span><span class="footer__icon"><i class="fas fa-heart"></i></span><span>这里是我的博客</span></div><div>欢迎来到我的博客</div></div></footer><div class="loading-bar" id="loading-bar"><div class="loading-bar__progress"></div></div><div class="back2top" id="back2top"><span class="back2top__icon"><i class="fas fa-rocket"></i></span></div></div><div class="search-mask"></div><div class="search-popup"><span class="search-close"></span><div class="search-input"><input placeholder="搜索文章（支持多关键词，请用空格分隔）"></div><div class="search-results"></div></div><script src="https://cdn.jsdelivr.net/npm/jquery@v3.4.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-animate@1.5.2/velocity.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-animate@1.5.2/velocity.ui.min.js"></script><script src="https://cdn.jsdelivr.net/npm/ribbon.js@latest/dist/ribbon.min.js" size="120" alpha="0.6" zIndex="-1"></script><script>function initSearch() {
  var isXML = true;
  var search_path = 'search.json';

  if (!search_path) {
    search_path = 'search.xml';
  } else if (/json$/i.test(search_path)) {
    isXML = false;
  }

  var path = '/' + search_path;
  $.ajax({
    url: path,
    dataType: isXML ? 'xml' : 'json',
    async: true,
    success: function (res) {
      var datas = isXML ? $('entry', res).map(function () {
        // 将 XML 转为 JSON
        return {
          title: $('title', this).text(),
          content: $('content', this).text(),
          url: $('url', this).text()
        };
      }).get() : res;
      var $input = $('.search-input input');
      var $result = $('.search-results');
      // 搜索对象（标题、内容）的权重，影响显示顺序
      var WEIGHT = { title: 100, content: 1 };
      var searchPost = function () {
        var searchText = $input.val().toLowerCase().trim();
        // 根据空白字符分隔关键字
        var keywords = searchText.split(/[\s]+/);
        // 搜索结果
        var matchPosts = [];

        // 有多个关键字时，将原文字整个保存下来
        if (keywords.length > 1) {
          keywords.push(searchText);
        }
        // 防止未输入字符时搜索
        if (searchText.length > 0) {
          datas.forEach(function (data) {
            var isMatch  = false;
            // 没有标题的文章使用预设的 i18n 变量代替
            var title = (data.title && data.title.trim()) || '[ 文章无标题 ]';
            var titleLower = title && title.toLowerCase();
            // 删除 HTML 标签 和 所有空白字符
            var content = data.content && data.content.replace(/<[^>]+>/g, '');
            var contentLower = content && content.toLowerCase();
            // 删除重复的 /
            var postURL = data.url && decodeURI(data.url).replace(/\/{2,}/g, '/');
            // 标题中匹配到的关键词
            var titleHitSlice = [];
            // 内容中匹配到的关键词
            var contentHitSlice = [];

            keywords.forEach(function (keyword) {
              /**
              * 获取匹配的关键词的索引
              * @param {String} keyword 要匹配的关键字
              * @param {String} text 原文字
              * @param {Boolean} caseSensitive 是否区分大小写
              * @param {Number} weight 匹配对象的权重。权重大的优先显示
              * @return {Array}
              */
              function getIndexByword (word, text, caseSensitive, weight) {
                if (!word || !text) {
                  return [];
                };

                var startIndex = 0; // 每次匹配的开始索引
                var index = -1;     // 匹配到的索引值
                var result = [];    // 匹配结果

                if (!caseSensitive) {
                  word = word.toLowerCase();
                  text = text.toLowerCase();
                }

                while((index = text.indexOf(word, startIndex)) !== -1) {
                  var hasMatch = false;
                  // 索引位置相同的关键词，保留长度较长的
                  titleHitSlice.forEach(function (hit) {
                    if (hit.index === index && hit.word.length < word.length) {
                      hit.word = word;
                      hasMatch = true;
                    }
                  });
                  startIndex = index + word.length;
                  !hasMatch && result.push({ index: index, word: word, weight: weight });
                }
                return result;
              }
              titleHitSlice = titleHitSlice.concat(getIndexByword(keyword, titleLower, false, WEIGHT.title));
              contentHitSlice = contentHitSlice.concat(getIndexByword(keyword, contentLower, false, WEIGHT.content));
            });

            var hitTitle = titleHitSlice.length;
            var hitContent = contentHitSlice.length;

            if (hitTitle > 0 || hitContent > 0) {
              isMatch = true;
            }
            if (isMatch) {
              ;[titleHitSlice, contentHitSlice].forEach(function (hit) {
                // 按照匹配文字的索引的递增顺序排序
                hit.sort(function (left, right) {
                  return left.index - right.index;
                });
              });
              /**
              * 给文本中匹配到的关键词添加标记，从而进行高亮显示
              * @param {String} text 原文本
              * @param {Array} hitSlice 匹配项的索引信息
              * @param {Number} start 开始索引
              * @param {Number} end 结束索引
              * @return {String}
              */
              function highlightKeyword (text, hitSlice, start, end) {
                if (!text || !hitSlice || !hitSlice.length) {
                  return;
                }

                var result = '';
                var startIndex = start;
                var endIndex = end;
                hitSlice.forEach(function (hit) {
                  if (hit.index < startIndex) {
                    return;
                  }

                  var hitWordEnd = hit.index + hit.word.length;
                  result += text.slice(startIndex, hit.index);
                  result += '<b>' + text.slice(hit.index, hitWordEnd) + '</b>';
                  startIndex = hitWordEnd;
                });
                result += text.slice(startIndex, endIndex);
                return result;
              }

              var postData = {};
              // 文章总的搜索权重
              var postWeight = titleHitSlice.length * WEIGHT.title + contentHitSlice.length * WEIGHT.content;
              // 标记匹配关键词后的标题
              var postTitle = highlightKeyword(title, titleHitSlice, 0, title.length) || title;
              // 标记匹配关键词后的内容
              var postContent;
              // 显示内容的长度
              var SHOW_WORD_LENGTH = 200;
              // 命中关键词前的字符显示长度
              var SHOW_WORD_FRONT_LENGTH = 20;
              var SHOW_WORD_END_LENGTH = SHOW_WORD_LENGTH - SHOW_WORD_FRONT_LENGTH;

              // 截取匹配的第一个字符，前后共 200 个字符来显示
              if (contentHitSlice.length > 0) {
                var firstIndex = contentHitSlice[0].index;
                var start = firstIndex > SHOW_WORD_FRONT_LENGTH ? firstIndex - SHOW_WORD_FRONT_LENGTH : 0;
                var end = firstIndex + SHOW_WORD_END_LENGTH;
                postContent = highlightKeyword(content, contentHitSlice, start, end);
              } else { // 未匹配到内容，直接截取前 200 个字符来显示
                postContent = content.slice(0, SHOW_WORD_LENGTH);
              }
              postData.title = postTitle;
              postData.content = postContent;
              postData.url = postURL;
              postData.weight = postWeight;
              matchPosts.push(postData);
            }
          });
        }

        var resultInnerHtml = '';
        if (matchPosts.length) {
          // 按权重递增的顺序排序，使权重大的优先显示
          matchPosts.sort(function (left, right) {
            return right.weight - left.weight;
          });
          resultInnerHtml += '<ul>';
          matchPosts.forEach(function (post) {
            resultInnerHtml += '<li><a class="search-results-title" href="' + post.url + '">';
            resultInnerHtml += post.title;
            resultInnerHtml += '</a><div class="search-results-content">';
            resultInnerHtml += post.content;
            resultInnerHtml += '</div></li>';
          });
          resultInnerHtml += '</ul>';
        } else {
          resultInnerHtml += '<div class="search-results-none"><i class="far fa-meh"></i></div>';
        }
        $result.html(resultInnerHtml);
      };
      $input.on('input', searchPost);
      $input.on('keyup', function (e) {
        if (e.keyCode === Stun.utils.codeToKeyCode('Enter')) {
          searchPost();
        }
      });
    }
  });
}

function closeSearch () {
  $('body').css({ overflow: 'auto' });
  $('.search-popup').css({ display: 'none' });
  $('.search-mask').css({ display: 'none' });
}

window.addEventListener('DOMContentLoaded', function () {
  Stun.utils.pjaxReloadLocalSearch = function () {
    $('.header-nav-search').on('click', function (e) {
      e.stopPropagation();
      $('body').css('overflow', 'hidden');
      $('.search-popup')
        .velocity('stop')
        .velocity('transition.expandIn', {
          duration: 300,
          complete: function () {
            $('.search-popup input').focus();
          }
        });
      $('.search-mask')
        .velocity('stop')
        .velocity('transition.fadeIn', {
          duration: 300
        });

      initSearch();
    });
    $('.search-mask, .search-close').on('click', function () {
      closeSearch();
    });
    $(document).on('keydown', function (e) {
      // Escape <=> 27
      if (e.keyCode === Stun.utils.codeToKeyCode('Escape')) {
        closeSearch();
      }
    });
  };

  Stun.utils.pjaxReloadLocalSearch();
}, false);

function safeOpenUrl(url) {
  var newTab = window.open();
  newTab.opener = null;
  newTab.location = url;
}

function extSearch(engine) {
  var engines = {
    google: 'https://www.google.com/search?q=',
    bing: 'https://cn.bing.com/search?q=',
    baidu: 'https://www.baidu.com/s?ie=UTF-8&wd=',
  };
  var host = window.location.host;
  var query = $('.search-input input').val().toLowerCase().trim();
  var uri = engines[engine] + query + ' site:' + host;

  if (query) {
    safeOpenUrl(uri);
  } else {
    Stun.utils.popAlert('warning', '请输入字符');
  }
}

var assistSearchList = window.CONFIG.assistSearch;

if (Array.isArray(assistSearchList)) {
  assistSearchList.forEach(function (name) {
    document.querySelector('.search-btns-item--' + name).addEventListener('click', function () {
      extSearch(name);
    }, false);
  });
}</script><script src="https://cdn.jsdelivr.net/npm/pjax@latest/pjax.min.js"></script><script>window.addEventListener('DOMContentLoaded', function () {
  var pjax = new Pjax({"selectors":["head title","#main",".pjax-reload"],"history":true,"scrollTo":false,"scrollRestoration":false,"cacheBust":false,"debug":false,"currentUrlFullReload":false,"timeout":0});
  // 加载进度条的计时器
  var loadingTimer = null;

  // 重置页面 Y 方向上的滚动偏移量
  document.addEventListener('pjax:send', function () {
    $('.header-nav-menu').removeClass('show');
    if (CONFIG.pjax && CONFIG.pjax.avoidBanner) {
      $('html').velocity('scroll', {
        duration: 500,
        offset: $('#header').height(),
        easing: 'easeInOutCubic'
      });
    }

    var loadingBarWidth = 20;
    var MAX_LOADING_WIDTH = 95;

    $('.loading-bar').addClass('loading');
    $('.loading-bar__progress').css('width', loadingBarWidth + '%');
    clearInterval(loadingTimer);
    loadingTimer = setInterval(function () {
      loadingBarWidth += 3;
      if (loadingBarWidth > MAX_LOADING_WIDTH) {
        loadingBarWidth = MAX_LOADING_WIDTH;
      }
      $('.loading-bar__progress').css('width', loadingBarWidth + '%');
    }, 500);
  }, false);

  window.addEventListener('pjax:complete', function () {
    clearInterval(loadingTimer);
    $('.loading-bar__progress').css('width', '100%');
    $('.loading-bar').removeClass('loading');
    setTimeout(function () {
      $('.loading-bar__progress').css('width', '0');
    }, 400);
    $('link[rel=prefetch], script[data-pjax-rm]').each(function () {
      $(this).remove();
    });
    $('script[data-pjax], #pjax-reload script').each(function () {
      $(this).parent().append($(this).remove());
    });

    if (Stun.utils.pjaxReloadBoot) {
      Stun.utils.pjaxReloadBoot();
    }
    if (Stun.utils.pjaxReloadScroll) {
      Stun.utils.pjaxReloadScroll();
    }
    if (Stun.utils.pjaxReloadSidebar) {
      Stun.utils.pjaxReloadSidebar();
    }
    if (false) {
      if (Stun.utils.pjaxReloadHeader) {
        Stun.utils.pjaxReloadHeader();
      }
      if (Stun.utils.pjaxReloadScrollIcon) {
        Stun.utils.pjaxReloadScrollIcon();
      }
      if (Stun.utils.pjaxReloadLocalSearch) {
        Stun.utils.pjaxReloadLocalSearch();
      }
    }
  }, false);
}, false);</script><div id="pjax-reload"></div><script src="/js/utils.js?v=2.6.2"></script><script src="/js/stun-boot.js?v=2.6.2"></script><script src="/js/scroll.js?v=2.6.2"></script><script src="/js/header.js?v=2.6.2"></script><script src="/js/sidebar.js?v=2.6.2"></script><script type="application/json" src="/search.json"></script><script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"debug":false,"model":{"jsonPath":"/live2dw/assets/koharu.model.json"},"display":{"position":"right","width":150,"height":300},"mobile":{"show":true},"react":{"opacity":0.7},"log":false});</script></body></html>